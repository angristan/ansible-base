---
- name: Add password to root user
  user:
    name: root
    password: '{{ vault.root_password }}'

- name: Add stanislas user
  user:
    name: stanislas
    groups: sudo
    shell: /usr/bin/fish
    password: '{{ vault.stanislas_password }}'

- name: Creates /home/stanislas/.ssh/ directory
  file:
    path: /home/stanislas/.ssh/
    state: directory
    owner: stanislas
    group: stanislas

- name: Set up SSH authorized keys
  template:
    src: 'ssh/authorized_keys.j2'
    dest: '{{ item }}'
  with_items:
    - /root/.ssh/authorized_keys
    - /home/stanislas/.ssh/authorized_keys

- name: Install basic packages
  apt:
    name:
      - fail2ban
      - haveged
      - netdata

- name: Set swappiness to 0
  sysctl:
    name: vm.swappiness
    value: 0
    state: present
    reload: yes

- name: Configure private network interface
  template:
    src: 'etc/network/interfaces.d/priv.cfg.j2'
    dest: '/etc/network/interfaces.d/priv.cfg'
  when: private_network_address is defined
  notify: network restart
  tags: base.network
